# 带你走进 Redis

> 作者：bobobliu，腾讯 CSIG 后台开发工程师

## 什么是 Redis

Redis 是一个开源、基于内存、使用 C 语言编写的 key-value 数据库，并提供了多种语言的 API。它的数据结构十分丰富，基础数据类型包括：string（字符串）、list（列表，双向链表）、hash（散列，键值对集合）、set（集合，不重复）和 sorted set（有序集合）。主要可以用于数据库、缓存、分布式锁、消息队列等...

以上的数据类型是 Redis 键值的数据类型，其实就是数据的保存形式，但是数据类型的底层实现是最重要的，底层的数据结构主要分为 6 种，分别是简单动态字符串、双向链表、压缩链表、哈希表、跳表和整数数组。各个数据类型和底层结构的对应关系如下：

数据类型和底层结构的对应关系

| string         | list               | hash             | set                | sorted set     |
| :------------- | :----------------- | :--------------- | :----------------- | :------------- |
| 简单动态字符串 | 双向链表、压缩链表 | 压缩链表、哈希表 | 压缩链表、整数数组 | 压缩链表、跳表 |

底层实现的时间复杂度

| 跳表    | 双向链表 | 压缩链表 | 哈希表 | 整数数组 |
| :------ | :------- | :------- | :----- | :------- |
| O(logN) | O(N)     | O(N)     | O(1)   | O(N)     |

可以看出除了 string 类型的底层实现只有一种数据结构，其他四种均有两种底层实现，这四种类型为集合类型，其中一个键对应了一个集合的数据；

## Redis 键值是如何保存的呢？

Redis 为了快速访问键值对，采用了**哈希表**来保存所有的键值对，一个哈希表对应了多个**哈希桶**，所谓的哈希桶是指哈希表数组中的每一个元素，当然哈希表中保存的不是值本身，是指向值的指针，如下图。

其中哈希桶中的 entry 元素中保存了*key 和*value 指针，分别指向了实际的键和值。通过 Redis 可以在 O(1)的时间内找到键值对，只需要计算 key 的哈希值就可以定位位置，但从下图可以看出，在 4 号位置出现了冲突，两个 key 映射到了同一个位置，这就产生了哈希冲突，会导致哈希表的操作变慢。虽然 Redis 通过链式冲突解决该问题，但如果数据持续增多，产生的哈希冲突也会越来越多，会加重 Redis 的查询时间；

![图片](http://dean-imgsubmit.oss-cn-beijing.aliyuncs.com/imm/640.png)